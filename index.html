<!-- index.html -->
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0d10" />
  <title>BWK-Aufgabenplanung</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <header class="topbar">
    <button class="icon-btn" id="btnToggleSidebar" aria-label="Seitenleiste √∂ffnen/schlie√üen">‚ò∞</button>

    <div class="brand">
      <div class="brand-title">BWK-Aufgabenplanung</div>
          </div>

    <div class="top-actions">
      <input class="search" id="searchInput" type="search" placeholder="Suchen‚Ä¶" inputmode="search" aria-label="Aufgaben durchsuchen" />
      <button class="btn" id="btnToday" title="Heute ausw√§hlen">Heute</button>
      <button class="btn" id="btnAddTask">+ Aufgabe</button>

      <button class="icon-btn" id="btnPrint" aria-label="Drucken" title="Drucken">üñ®Ô∏è</button>
      <button class="icon-btn" id="btnExportOverview" aria-label="√úbersicht exportieren" title="√úbersicht (CSV) exportieren">üßæ</button>
      <button class="icon-btn" id="btnSettings" aria-label="Einstellungen" title="Einstellungen">‚öôÔ∏è</button>
      <button class="icon-btn" id="btnHelp" aria-label="Hilfe" title="Hilfe">?</button>
      <button class="icon-btn" id="btnReload" aria-label="App neu laden" title="App neu laden">‚ü≥</button>

      <button class="icon-btn" id="btnSaveNow" aria-label="Jetzt lokal speichern" title="Jetzt lokal speichern">üíæ</button>
      <button class="icon-btn" id="btnExport" aria-label="Backup exportieren" title="Backup exportieren">‚¨áÔ∏è</button>

      <input id="importFile" type="file" accept="application/json" hidden />
      <button class="icon-btn" id="btnImport" aria-label="Backup importieren" title="Backup importieren">‚¨ÜÔ∏è</button>
    </div>
  </header>

  <div class="shell">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-head">
        <div class="sidebar-title">Personen / Gruppen</div>
        <button class="icon-btn" id="btnAddPerson" aria-label="Person hinzuf√ºgen" title="Person hinzuf√ºgen">Ôºã</button>
      </div>

      <div class="person-list" id="personList"></div>

      <div class="sidebar-foot">
        <div class="tiny" id="saveInfo">‚Äî</div>
        <div class="tiny" id="appInfo">‚Äî</div>
      </div>
    </aside>

    <main class="content">
      <section class="grid">
        <div class="card calendar-card">
          <div class="card-head">
            <div class="card-title">Kalender</div>
            <div class="calendar-nav">
              <button class="icon-btn" id="btnPrevMonth" aria-label="Vorheriger Monat">‚óÄ</button>
              <div class="calendar-month" id="calendarMonthLabel">‚Äî</div>
              <button class="icon-btn" id="btnNextMonth" aria-label="N√§chster Monat">‚ñ∂</button>
            </div>
          </div>

          <div class="weekday-row" id="weekdayRow"></div>
          <div class="calendar-grid" id="calendarGrid"></div>

          <div class="calendar-foot">
            <div class="tiny" id="selectedDayLabel">‚Äî</div>
          </div>

          <details class="ferien" id="ferienDetails">
            <summary class="tiny">Ferien (Berlin) <span class="muted" id="ferienSummary"></span></summary>
            <div class="tiny" id="ferienBox">‚Äî</div>
          </details>
        </div>

        <div class="card lists-card">
          <div class="card-head">
            <div class="card-title">Aufgaben</div>
            <div class="chip" id="activePersonChip">‚Äî</div>
          </div>

      <div class="print-meta" id="printMeta"></div>

      <details class="section" open>
        <summary class="section-title">Planungs-√úbersicht <span class="count" id="countOverview">0</span></summary>
        <div class="section-hint">Mini-Statistik f√ºr die aktive Person (gefiltert durch Suche). Fokus: n√§chste 14 Tage + Status.</div>
        <div class="analytics">
          <div class="analytics-card">
            <div class="analytics-title">N√§chste 14 Tage</div>
            <canvas id="chartWorkload" width="680" height="160" aria-label="Auslastung" role="img"></canvas>
          </div>
          <div class="analytics-card">
            <div class="analytics-title">Status</div>
            <div class="statusbar" id="statusBar" aria-label="Status-Verteilung"></div>
            <div class="legend" id="statusLegend"></div>
          </div>
        </div>
      </details>

      <details class="section" open>
        <summary class="section-title">Meilensteine (n√§chste 90 Tage) <span class="count" id="countMilestones">0</span></summary>
        <div id="listMilestones" class="task-list"></div>
      </details>

          <details class="section" open>
            <summary class="section-title">F√ºr den ausgew√§hlten Tag <span class="count" id="countDay">0</span></summary>
            <div id="dayTasks" class="task-list"></div>
          </details>

          <details class="section" open>
            <summary class="section-title">In Arbeit <span class="count" id="countInProgress">0</span></summary>
            <div id="listInProgress" class="task-list"></div>
          </details>

          <details class="section" open>
            <summary class="section-title">Geplant <span class="count" id="countPlanned">0</span></summary>
            <div id="listPlanned" class="task-list"></div>
          </details>

          <details class="section">
            <summary class="section-title">Backlog (ohne Datum) <span class="count" id="countBacklog">0</span></summary>
            <div class="section-hint">Backlog = ohne Datum. √ñffne eine Aufgabe und erg√§nze Start/Ende, um sie einzuplanen.</div>
            <div id="listBacklog" class="task-list"></div>
          </details>

          <details class="section">
            <summary class="section-title">Erledigt <span class="count" id="countDone">0</span></summary>
            <div id="listDone" class="task-list"></div>
          </details>
        </div>
      </section>
    </main>
  </div>

  <!-- Person Modal -->
  <dialog class="modal" id="personDialog">
    <form method="dialog" class="modal-box" id="personForm">
      <div class="modal-title" id="personDialogTitle">Person hinzuf√ºgen</div>

      <label class="field">
        <span>Name</span>
        <input id="personName" type="text" required minlength="1" maxlength="40" placeholder="z. B. Nico, Team AV√∂D, ‚Ä¶" />
      </label>

      <div class="modal-actions">
        <button class="btn ghost" id="personCancel" type="button">Abbrechen</button>
        <button class="btn" id="personSubmit" value="ok">Speichern</button>
      </div>

      <input type="hidden" id="personEditId" />
    </form>
  </dialog>

  <!-- Task Modal -->
  <dialog class="modal" id="taskDialog">
    <form method="dialog" class="modal-box" id="taskForm">
      <div class="modal-title" id="taskDialogTitle">Aufgabe hinzuf√ºgen</div>

      <label class="field">
        <span>Aufgabenname</span>
        <input id="taskTitle" type="text" required minlength="1" maxlength="80" placeholder="z. B. Zugangsdaten anfordern, Termin planen, ‚Ä¶" />
      </label>

      <div class="field">
        <span>Zuweisen an</span>
        <div id="assigneeList" class="assignees"></div>
        <div class="tiny">Mehrfachauswahl m√∂glich.</div>
      </div>

      <div class="row">
        <label class="field">
          <span>Typ</span>
          <select id="taskKind">
            <option value="task">üß© Aufgabe</option>
            <option value="appointment">üïí Termin</option>
            <option value="milestone">üèÅ Meilenstein</option>
          </select>
        </label>

        <label class="field">
          <span>Priorit√§t (Gewichtung)</span>
          <select id="taskPriority">
            <option value="0">Keine</option>
            <option value="1">‚óè Niedrig</option>
            <option value="2">‚óè‚óè Mittel</option>
            <option value="3">‚óè‚óè‚óè Hoch</option>
          </select>
        </label>
      </div>

      <div class="row">
        <label class="field">
          <span>Wiederholung</span>
          <select id="taskRepeat">
            <option value="none">Keine</option>
            <option value="daily">T√§glich</option>
            <option value="weekly">W√∂chentlich</option>
            <option value="monthly">Monatlich</option>
          </select>
        </label>

        <label class="field" id="timeHintField">
          <span>Uhrzeit (nur Termin)</span>
          <div class="tiny">Wenn du keinen Termin planst, ignorieren.</div>
        </label>
      </div>

      <label class="field inline">
        <input id="taskIsBacklog" type="checkbox" />
        <span>Ohne Datum (Backlog)</span>
      </label>

      <div class="row" id="dateRow">
        <label class="field">
          <span>Start</span>
          <input id="taskStart" type="date" />
        </label>
        <label class="field">
          <span>Ende</span>
          <input id="taskEnd" type="date" />
        </label>
      </div>

      <div class="row" id="timeRow">
        <label class="field">
          <span>Von</span>
          <input id="taskTimeStart" type="time" />
        </label>
        <label class="field">
          <span>Bis</span>
          <input id="taskTimeEnd" type="time" />
        </label>
      </div>

      <label class="field">
        <span>Notiz (optional)</span>
        <textarea id="taskNote" rows="3" maxlength="500" placeholder="kurz & hilfreich‚Ä¶"></textarea>
      </label>

      <div class="hint" id="taskHint"></div>

      <div class="modal-actions">
        <button class="btn ghost" id="taskCancel" type="button">Abbrechen</button>
        <button class="btn danger" id="taskDeleteBtn" value="delete" type="button">L√∂schen</button>
        <button class="btn" id="taskSubmit" value="ok">Speichern</button>
      </div>

      <input type="hidden" id="taskEditId" />
    </form>
  </dialog>

  <!-- Import Modal -->
  <dialog class="modal" id="importDialog">
    <div class="modal-box">
      <div class="modal-title">Import</div>
      <div class="hint">
        Du kannst die importierten Daten entweder <b>ersetzen</b> (empfohlen nach Cookie-L√∂schung),
        oder <b>zusammenf√ºhren</b> (merge).
      </div>

      <div class="modal-actions">
        <button class="btn ghost" id="importCancel">Abbrechen</button>
        <button class="btn" id="importMerge">Zusammenf√ºhren</button>
        <button class="btn danger" id="importReplace">Ersetzen</button>
      </div>
    </div>
  </dialog>


  <!-- Settings Modal -->
  <dialog class="modal" id="settingsDialog">
    <div class="modal-box">
      <div class="modal-title">Einstellungen</div>
      <div class="hint">Theme + Akzent (wie in der Stundenplan-App). Speichert lokal im Browser.</div>

      <div class="form-grid">
        <label class="field">
          <span>Theme</span>
          <select id="setTheme">
            <option value="system">System</option>
            <option value="dark">Dunkel</option>
            <option value="light">Hell</option>
          </select>
        </label>

        <label class="field">
          <span>Akzent (gedeckt)</span>
          <select id="setAccent">
            <option value="blue">Blau</option>
            <option value="green">Gr√ºn</option>
            <option value="wine">Weinrot</option>
            <option value="violet">Violett</option>
            <option value="brown">Braun</option>
            <option value="mustard">Senf</option>
          </select>
        </label>
      </div>

      <div class="modal-actions">
        <button class="btn" id="settingsClose">Schlie√üen</button>
        <button class="btn primary" id="settingsSave">Speichern</button>
      </div>
    </div>
  </dialog>

  <!-- Help Modal -->
  <dialog class="modal" id="helpDialog">
    <div class="modal-box">
      <div class="modal-title">Kurzanleitung</div>
      <div class="hint">
        <b>Kalender</b>: Klick = Tag ausw√§hlen. Doppelklick (oder Doppeltippen am Handy) = neue Aufgabe f√ºr diesen Tag.
        <br><br>
        <b>Aufgabe/Termin/Meilenstein</b>: Im Dialog kannst du den Typ w√§hlen.
        <ul class="help-list">
          <li><b>Aufgabe</b>: klassisch (Start/Ende optional als Zeitraum).</li>
          <li><b>Termin</b>: ein Tag, optional mit Uhrzeit.</li>
          <li><b>Meilenstein</b>: ein Tag (z. B. Abgabe, Deadline).</li>
        </ul>
        <b>Backlog</b>: ohne Datum ‚Äì ideal zum Sammeln. Sp√§ter planen oder direkt starten.
        <br><br>
        <b>Speichern</b>: Standardm√§√üig lokal im Browser. F√ºr Austausch im Team: JSON exportieren und importieren.
      </div>

      <div class="modal-actions">
        <button class="btn" id="helpClose">OK</button>
      </div>
    </div>
  </dialog>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script src="script.js"></script>
</body>
</html>
